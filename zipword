
# ==============================================================================
# æ­¥é©Ÿ 1: å®‰è£ gdown (å°ˆé–€ç”¨æ–¼ Google Drive ä¸‹è¼‰çš„å·¥å…·)
# ==============================================================================
!pip install gdown -q
import os
import zipfile
import glob
import gdown

print("âœ… å°ˆæ¥­ä¸‹è¼‰å·¥å…· gdown å·²æº–å‚™å°±ç·’ã€‚")

# ==============================================================================
# æ­¥é©Ÿ 2: è¨­å®šæª”æ¡ˆè·¯å¾‘èˆ‡ç›®æ¨™ (å·²ä¿®æ­£ç›®æ¨™å‰¯æª”å)
# ==============================================================================
google_drive_file_id = '1NKofD5jLOI762WNvCdJNpmZQoJ5D95mG'
local_zip_filename = 'Noto_Sans_TC_from_Drive.zip'
# --- å”¯ä¸€çš„ä¿®æ­£ä¹‹è™• ---
target_font_filename = 'NotoSansTC-Regular.ttf' # <-- å¾ .otf ä¿®æ­£ç‚º .ttf
# ---------------------
extract_path = '/content/final_extracted_fonts'

print("ğŸ”© ç›®æ¨™è¨­å®šï¼š")
print(f"   - Google Drive æª”æ¡ˆ ID: {google_drive_file_id}")
print(f"   - æœ¬åœ°æª”å: {local_zip_filename}")
print(f"   - ç›®æ¨™å­—é«”: {target_font_filename} (å·²ä¿®æ­£)")
print(f"   - è§£å£“ç¸®ä½ç½®: {extract_path}")

# ==============================================================================
# æ­¥é©Ÿ 3: åŸ·è¡Œæœ€çµ‚çš„è‡ªå‹•åŒ–ä¸‹è¼‰èˆ‡é©—è­‰æµç¨‹
# ==============================================================================
found_font_path = None

try:
    # --- (1/4) ä½¿ç”¨ gdown å¾ Google Drive ä¸‹è¼‰å£“ç¸®æª” ---
    print(f"\nğŸ“¥ (1/4) æ­£åœ¨ä½¿ç”¨å°ˆæ¥­å·¥å…·å¾æ‚¨çš„ Google Drive é€£çµä¸‹è¼‰ '{local_zip_filename}'...")
    gdown.download(id=google_drive_file_id, output=local_zip_filename, quiet=False)
    print("ğŸ‘ ä¸‹è¼‰æˆåŠŸï¼")

    # --- (2/4) å»ºç«‹æš«å­˜è³‡æ–™å¤¾ä¸¦è§£å£“ç¸® ---
    print("\nğŸ“¦ (2/4) æ­£åœ¨è§£å£“ç¸®æª”æ¡ˆ...")
    if not os.path.exists(local_zip_filename):
        raise FileNotFoundError(f"éŒ¯èª¤ï¼šæª”æ¡ˆä¸‹è¼‰å¾Œä½†åœ¨æœ¬åœ°æ‰¾ä¸åˆ°ï¼")

    os.makedirs(extract_path, exist_ok=True)
    with zipfile.ZipFile(local_zip_filename, 'r') as zip_ref:
        zip_ref.extractall(extract_path)
    print(f"ğŸ‘ æˆåŠŸè§£å£“ç¸®è‡³ '{extract_path}'")

    # --- (3/4) éè¿´æœå°‹ç›®æ¨™å­—é«”æª”æ¡ˆ ---
    print(f"\nğŸ•µï¸ (3/4) æ­£åœ¨æœå°‹ '{target_font_filename}'...")
    search_pattern = os.path.join(extract_path, '**', target_font_filename)
    search_results = glob.glob(search_pattern, recursive=True)

    if not search_results:
        raise FileNotFoundError(f"éŒ¯èª¤ï¼šè§£å£“ç¸®å¾Œæ‰¾ä¸åˆ°ç›®æ¨™å­—é«” '{target_font_filename}'ï¼")

    found_font_path = search_results[0]
    print(f"ğŸ‘ æ‰¾åˆ°ç›®æ¨™å­—é«”ï¼")

    # --- (4/4) æœ€çµ‚æˆåŠŸé©—è­‰ ---
    print("\nâœ… (4/4) æœ€çµ‚é©—è­‰...")
    print("="*50)
    print("ğŸ‰ğŸ‰ğŸ‰ æœ€çµ‚é©—è­‰æˆåŠŸï¼ ğŸ‰ğŸ‰ğŸ‰")
    print("="*50)
    print("æˆ‘å€‘å·²æˆåŠŸåœ¨ Colab ç’°å¢ƒä¸­ï¼Œé€éæœ€ç©©å®šçš„æ–¹å¼ï¼Œ")
    print("ç›´æ¥å¾æ‚¨æŒ‡å®šçš„ Google Drive é€£çµä¸‹è¼‰ã€è§£å£“ç¸®ä¸¦å®šä½åˆ°å­—é«”æª”æ¡ˆã€‚")
    print(f"\nğŸ“ å­—é«”æª”æ¡ˆçš„çµ•å°è·¯å¾‘ç‚ºï¼š\n   {found_font_path}")
    print("\né€™ä»£è¡¨æˆ‘å€‘çš„ä¸­æ–‡å­—é«”æ–¹æ¡ˆå®Œå…¨å¯è¡Œï¼Œæ ¸å¿ƒæŒ‘æˆ°å·²æˆåŠŸè§£æ±ºï¼")

except Exception as e:
    print("\nâŒâŒâŒ é©—è­‰å¤±æ•— âŒâŒâŒ")
    print(f"\néŒ¯èª¤è©³æƒ…ï¼š\n{e}")
